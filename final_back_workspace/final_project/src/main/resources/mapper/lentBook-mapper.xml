<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.or.iei.myPage.lentBookList.model.dao.LentBookListDao">
 
 <!-- 대출 현황 목록 조회 -->
 	<select id="selectBorrowBook" parameterType="string" resultType="kr.or.iei.myPage.lentBookList.model.dto.LentBook">
 		select lb.lent_book_no as lentBookNo, b.title_info as title, lb.return_date as returnDate, lb.actual_return_date asactualReturnDate, b.image_url as imageUrl
 			from tbl_lent_book lb
 			join tbl_book b on lb.lent_call_no = b.call_no
 			where lent_member_no = #{parameter} and b.can_lend = 'L'
 	</select>
 	
 	<!-- 대출 연장 업데이트 -->
<update id="renewBook" parameterType="string">
	update tbl_lent_book set return_date = to_char(to_date(return_date, 'YYYYMMDD') + 7 , 'YYYYMMDD'),
		can_renew = 'F'
	where lent_book_no = #{parameter} and can_renew = 'T' and exists (select 1 from tbl_book b 
		where b.call_no = (select lb.lent_call_no from tbl_lent_book lb 
			where lb.lent_book_no = #{parameter}
		)
		and b.can_lend != 'R'
	)
</update>
</mapper>
